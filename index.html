<html>

<head>
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
</head>

<body>
  <div id="container">foo</div>
</body>

<style>
.foo {
  font-size: 20px;
}
</style>

<script src="aight.js"></script>
<script src="domchanger.js"></script>

<script>
function TodoApp(emit, refresh) {
  var items = [], text = "";

  return { render: render };

  function render() {
    return ["div",
      ["h3", "TODO"],
      [TodoList, items],
      ["form", { onsubmit: handleSubmit },
        ["input", {
          onchange: onChange,
          onkeypress: onKeyPress,
          value: text,
          id: "input",
          klass: "foo"
        }],
        ["button", "Add #", items.length + 1]
      ]
    ];
  }

  function handleSubmit(evt) {
    evt.preventDefault();
    if (text !== "") {
      items.push(text);
      text = "";
      refresh();
    };
  }

  function onKeyPress(evt) {
    text = document.getElementById("input").value;
    if (evt.keyCode == 13) {
      if (text !== "") {
        items.push(text);
        text = "";
        refresh();
      };
    };
  }

  function onChange(evt) {
    var val = evt.target.value;
    text = val;
    evt.preventDefault();
  }
}

function TodoList() {
  return { render: render };
  function render(items) {
    return ["ul", items.map(function (itemText) {
      return ["li", itemText];
    })];
  }
}

domChanger(TodoApp, document.body).update()
</script>

</html>
